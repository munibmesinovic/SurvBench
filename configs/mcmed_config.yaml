# MC-MED Dataset Configuration

dataset:
  name: mcmed
  base_dir: data/mcmed_raw_data  # UPDATE THIS PATH to your raw files

  files:
    # These keys now point to your RAW files
    labels: visits.csv
    static: visits.csv
    timeseries_vitals: numerics.csv
    timeseries_lab: labs.csv
    icd_codes: pmh.csv
    radiology_embeddings: rads.csv # This key is used to load rads.csv

  cohort:
    min_stay_hours: 0.0  # Filtering is handled by loader
    max_age: 120

  # Competing risks configuration
  competing_risks:
    enabled: true
    outcome_mapping:
      0: "Censored"           # Discharge
      1: "ICU Admission"      # ICU
      2: "Hospital Admission" # Inpatient
      3: "Observation"        # Observation

preprocessing:
  # --- Parameters from CausalSurv Notebook ---
  num_windows: 6
  window_size_hours: 1
  max_hours: 6                  # Input window T=6 (0-5h)
  max_horizon_hours: 24         # Label/outcome horizon
  n_time_bins: 10               # 10 bins for 24h horizon
  # --- End Notebook Parameters ---

  discretisation_method: quantiles
  missingness_threshold: 0.01

  # Label columns (set by loader)
  event_col: event
  duration_col: duration

  imputation:
    static: mean
    dynamic: zero

  scaling:
    method: standard
    apply_to: dynamic

splits:
  train: 0.7
  val: 0.1
  test: 0.2
  seed: 42
  split_by: patient # Uses 'subject_id' (MRN) from loader

# --- ENABLE ALL MODALITIES ---
modalities:
  timeseries: true
  static: true
  icd: true
  radiology: false

# ICD code processing (if enabled)
icd_processing:
  top_n_codes: 500  # you can set

# Radiology processing (if enabled)
radiology_processing:
  bert_batch_size: 32
  bert_max_length: 1024

output:
  dir: data/mcmed_processed_final  # UPDATE THIS PATH
  prefix: mcmed
  save_format: numpy

  files:
    # Data splits
    x_train: x_train_mcmed.npy
    x_val: x_val_mcmed.npy
    x_test: x_test_mcmed.npy

    # Labels
    y_train: y_train_surv_mcmed.p
    y_val: y_val_surv_mcmed.p
    durations_test: durations_test_mcmed.npy
    events_test: events_test_mcmed.npy

    # Auxiliary
    cuts: cuts_mcmed.npy
    out_features: out_features_mcmed.npy
    n_events: n_events_mcmed.npy
    feature_names: feature_names_mcmed.pkl
    modality_info: modality_info_mcmed.pkl
    scaler: scaler_mcmed.pkl

    # Masks
    train_mask: x_train_mcmed_mask.npy
    val_mask: x_val_mcmed_mask.npy
    test_mask: x_test_mcmed_mask.npy